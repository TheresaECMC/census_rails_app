<script src="//maps.google.com/maps/api/js?v=3.18&sensor=false&client=&key=&libraries=geometry&language=&hl=&region="></script> 
<script src="//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js"></script>

<h1>Cencus Data for Each Person</h1>

<div class='data_person'>
  <% @person_data_written.each do |individual_data|%>
    <h2><%= individual_data.person.name %></h2>
    <p>
      <div class="data_facts">They live in <%= individual_data.person.state.name%> which has a population of <%= number_with_delimiter(individual_data.state_pop, :delimiter => ',') %>.
      </div>
    </p>
    <p>
      <div class="data_facts">In <%= individual_data.person.state.name%> there are <%= number_with_delimiter(individual_data.gender_pop, :delimiter => ',') %> <%= individual_data.person.sex.downcase%>s.
      </div>
    </p>
    <p>
      <div class="data_facts">Of the <%= number_with_delimiter(individual_data.state_pop, :delimiter => ',') %> people in <%= individual_data.person.state.name%>, <%= number_with_delimiter(individual_data.gender_race_pop, :delimiter => ',') %> of them are also <%= individual_data.person.race.name%> and <%= individual_data.person.sex.downcase%> and <%= number_with_delimiter(individual_data.gender_age_pop, :delimiter => ',') %> of them are also <%= individual_data.person.sex.downcase%> and <%= individual_data.person.age%>.
      </div>
    </p>
    <p>
      <div>Combining all your data together, of the <%= number_with_delimiter(individual_data.state_pop, :delimiter => ',') %> people in <%= individual_data.person.state.name%>, <%= number_with_delimiter(individual_data.gender_age_and_race_pop, :delimiter => ',') %> of them are also a <%= individual_data.person.age%>-year-old, <%= individual_data.person.race.name%> <%= individual_data.person.sex.downcase%>.
      </div>
    </p>
    <p>
      <div>Finally, since <%= individual_data.person.state.name%> is <%= number_with_delimiter(individual_data.person.state.land_area, :delimiter => ',') %> square miles, you would only have to walk  <%= individual_data.person_per_sq_miles%> miles, to meet another <%= individual_data.person.age%>-year-old, <%= individual_data.person.race.name%> <%= individual_data.person.sex.downcase%>.
      </div>
    </p>
    <p>
      <div>Interesting, right!?
      </div>
    </p><br>
  <%end%>
</div>

<div class ="info_break">
  <p>
    Check out the data on the GoogleMaps. Want to meet a person of simliar race, sex and age? Statistically, all you have to do is walk outside the circle!  There's even some bars within the circle to ensure you're a unique individual whenever you go out!
  </p>
</div>
<div class='google_search'>
  Not into bars? Pick something else where you'll be statistically unique!  Search something else: 
  <div class="search_field">
    <%= form_tag('/google_query', method: :get) do %>
      <%= text_field_tag(:google_query)%>
      <%= submit_tag("Amend Search")%>
    <%end%>
  </div>
</div>
<div style='width: 800px;'>
  <div id="map" style='width: 800px; height: 400px;'></div>

<%if @search != nil%>
  <script type="text/javascript">
    var person_info_hash = <%=raw @google_hash.to_json%>;
    console.log("I'm in the 'if'");
    var search = <%=raw @search.to_json%>;
  </script>
<%else%>
  <script type="text/javascript">
    var person_info_hash = <%=raw @google_hash.to_json%>;
    var search = {query: ['bar']};
    console.log("I'm in the else");
  </script>
<%end %>

<% content_for :javascript_event_controllers do %>
  <%=javascript_include_tag 'google_maps', 'data-turbolinks-track' => true %>
<%end%>

<script src="https://maps.googleapis.com/maps/api/js?key= 
  AIzaSyAqS_1E4xE5Ge1J5RYknaR1suHjidlVsCs&callback=initMap&libraries=geometry,places" async defer>
</script>
